print = function() end
_ENV = require('lunity')('uuid library')

function test:table()
    assertType(uuid, 'table')
end

function test:teststring()
    local u = uuid.new '123e4567-e89b-12d3-a456-426655440000'
    assertEqual(u:version(), 1)
    assertEqual(u:node(), tonumber("426655440000", 16))

    assertEqual(u.lsb, -6605018796207636480)
    assertEqual(u.msb, 1314564453825188563)
    assertEqual(tostring(u), '123e4567-e89b-12d3-a456-426655440000')

    local arr = {
        "c6eb196e-cc86-417d-be3c-e15632bead21",	"882a3d12-aa69-4550-8a76-2329e711a160",	"f5485172-2f95-4ce6-bcbe-15f0ceb72c4b",	"dd15d964-3189-43b6-b671-f66fd4dfa0c7",	"729a3c11-9f53-4e68-baf8-07453c771ecd",	"697d2da5-19da-4c66-a38b-7c1d02e61d1f",
        "0daf259e-01c5-45bf-9740-93cb9d9c5a51",	"5e987ee9-0dc1-474f-9131-71e0bbee8529",	"c07ed2b7-3186-4705-8e3f-913baa311a51",	"e8024eab-c55e-4838-9aaa-365bf063c571",	"844c3f21-d843-4dd7-bd56-58a44a937b5b",	"36f0c3d9-c26a-401f-837e-e26f928fa7ba",
        "d928663a-c00a-4875-bcc1-52a563966125",	"6842ca08-e39c-49a2-923b-5683ed103e22",	"7525576a-bab1-4d8b-9e1a-357b2504af0e",	"776f1756-059e-4bde-8dbd-b1840bd50af7",	"eeb9753d-0bbc-483a-9aad-d7ffba0b5011",	"b50c3dee-b87c-46b9-8f82-f81ba65780f3",
        "ff8c9421-3c88-4ec9-9e8b-5455c8826cf7",	"8061879f-90e3-4370-b456-54b9e512acbb",	"0585f0f9-bc19-4300-be33-a222127463b8",	"75b2d7ec-9499-4c08-88cc-021b0c437912",	"5240b491-fc8e-4be6-88b9-aeb232cc9334",	"6b716b45-8cfa-466c-8f6e-0d0520376987",
        "e2f49e29-0592-493c-be01-22e806c163c8",	"33346b75-1048-4276-ac73-68b075f0bab2",	"f47a2b9f-8492-4280-923f-f4a4898ec6e0",	"0ba5baf2-9b1a-4d5b-a4bf-f918fbeef5cb",	"56ab259a-9622-4c90-82b7-63bdb480a979",	"2a7ca6cd-807a-40e4-8554-aec53185ccb9",
        "3bd807cd-4bda-4b9e-8b0f-aa636af0a555",	"59131125-64cc-4bcb-a801-c05cc18ddba2",	"b37e6a88-f1ea-492c-83ee-e9d06dfb13ed",	"013b7d5d-31cd-40d7-95e3-f7510b6cb79b",	"af075239-4fba-44ed-8dce-3b7b211cc161",	"d726b043-d723-48cc-b07e-f9cec8927cf9",
        "00cb50ac-1352-4972-bf75-ce1dc7e3c255",	"041c4263-e820-4786-bee8-104ed65ac5e6",	"240bfee4-7464-4885-9b96-a360aa636c63",	"494301af-bf93-4afd-bd28-989249bcd3c8",	"f8c9740f-5cf2-4960-90ed-7b7239da7040",	"46a0dba7-b386-42f2-aa42-c82c53e8a28d",
        "a47eca1e-143d-4cf3-b685-df27556660a4",	"bda5ba0a-9446-4db3-be1b-4d2b5211e642",	"14593111-1a92-434b-84ad-aade55452225",	"9aa8499d-5162-4c48-9bcc-3b28e64e8330",	"3d9cd064-e0a9-4676-bd66-838ec8dc827e",	"077f91f1-5087-44a5-9663-3037003c11b9",
        "816368f6-2ab2-45f1-b267-94db6361570c",	"6858bc74-040f-470c-831b-72a469905339",	"03d528c9-4b6d-4d6a-841d-40d5c9374a08",	"18dc82ef-eb77-44ef-97c0-5965561ecef1",	"c1ed3fb4-fde4-441f-a882-c6fb1ccf7dc1",	"757b1d44-8f86-4897-a0ad-63310faa448d",
        "7906ec22-f6ad-4076-b4fe-94fa61d1c3e5",	"a389f1fa-b56a-469b-b75c-df604cdfcfc7",	"7b98b4b2-402c-4dfb-a48e-e7a75bc06ce7",	"16153bb6-a3d3-4a1a-84bc-7a465f3c60f5",	"86162982-b4fd-4e79-959f-b17f4a1b97e7",	"64058ccc-aedb-475a-b841-f7d2e57b9d0d",
        "c334d068-973d-47e2-9fb3-c496c85944e2",	"b3e7ae71-3666-4675-991e-f0b4af8462b6",	"e4eb716d-46aa-48f0-86b7-2277c84bccf2",	"b6e665e1-3fec-402e-ae94-8f3ce8895e9c",	"bea4262f-83eb-4b79-be5b-cf0d323fe9d0",	"a9e3a114-28b8-4e96-98d3-4b652ac646c9",
    }
    for _, v in ipairs(arr) do
        u = uuid.new(v)
        assertEqual(4, u:version())

        assertEqual(v, tostring(u))
    end
end

function test:testbits()
    local u = uuid.new(1314564453825188563, -6605018796207636480)
    assertEqual(u:version(), 1)
    assertEqual(u:node(), tonumber("426655440000", 16))

    assertEqual(u.lsb, -6605018796207636480)
    assertEqual(u.msb, 1314564453825188563)
    assertEqual(tostring(u), '123e4567-e89b-12d3-a456-426655440000')

    local arr = {
        { -7165309594163578388, 9006089171674611969 }, { -7307065038029240156, -8240624096449183504 }, { -8831116932094999751, 6282592233936079981 }, { -8414766677096984606, 1105889678012272023 },
        { -6387934006418394633, -7557058091108839840 }, { -8124542804480979122, -8145551727699606286 }, { -8753666970657082273, -6325516921646464334 }, { -5649772657225592077, -4892195038926453452 },
        { -7039356253473560136, -5081759705017659759 }, { -8361175158718682097, -1203034387007254958 }, { -5270983300939685652, -2504656201025894074 }, { -8589938240343898552, 3299134217488122940 },
        { -8759273787321390428, 9148883584896026629 }, { -5961497649311997656, -9178933916480352557 }, { -7894610822385325612, 8206802350435092508 }, { -6878204990617993836, 3310683183281817747 },
        { -8047034499532933209, -5968155722830624655 }, { -7997899891754627076, -2314879292978868444 }, { -5726852871267379832, 2766911143579959652 }, { -7869372465693793129, 5479209352975240065 },
        { -8523115755772410356, 4175348003281650028 }, { -5150762597115964849, -2756448946152583795 }, { -8485750041032874483, -3701288056519375048 }, { -6561713835436177522, 2482553107744639746 },
        { -8839935122235512258, 636598046278307532 }, { -8376543278200007797, -8833808011216597398 }, { -6724977395115826279, -1121167752362507852 }, { -8534379432325582817, -3207652786254558188 },
        { -7898962896514739151, 8634973781804926102 }, { -7065499075496551983, 6835558839440133662 }, { -6626711518028929379, -5656577354810702672 }, { -8551011021350281394, 2918401328562523974 },
        { -8424306985229332758, -537392163223286757 }, { -7077188998165079857, -6778414125343027407 }, { -8083582521722929794, -8552616683633162418 }, { -7780344222697952294, 1337791813199874539 },
        { -7219748333675045855, 5620847956869335663 }, { -6510305179859846952, 4827901020538161805 }, { -4929549130425262285, -2492688864712965981 }, { -5016528207831597187, -1238750578285067407 },
        { -6569876805101955240, -854889447570063135 }, { -6788647233323487115, -506017217521890609 }, { -6220472706245235780, -7413969003778650299 }, { -7696930465451416807, -325522553430651037 },
    }
    for _, v in ipairs(arr) do
        u = uuid.new(v[2], v[1])
        assertEqual(u:version(), 4)

        assertEqual(u.lsb, v[1])
        assertEqual(u.msb, v[2])
    end
end

local allPassed = test{
    useANSI=false, -- turn off ANSI codes (colors/bold) in the output
    useHTML=false,  -- turn on  HTML markup in the output
    quiet=true,    -- silence print() and io.write() other than Lua during the tests
}

assert(allPassed)

return true